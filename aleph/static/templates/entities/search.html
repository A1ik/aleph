<div class="screen">
  <div class="row" ng-show="!isEmpty()">
    <div class="col-md-8">
      <div class="search-bar">
        <form class="form-horizontal" role="search" ng-submit="submitSearch(form)">
          <div class="input-group">
            <input type="text" class="form-control" autofocus
                   ng-model="query.state.q" placeholder="Search people and companies">
            <span class="input-group-btn">
              <button class="btn btn-primary" type="submit">
                <i class="fa fa-search" aria-hidden="true"></i>
                Search
              </button>
            </span>
          </div>
        </form>
      </div>

      <div class="alert alert-danger" role="alert" ng-if="result.error">
        <strong>An error occurred while running your search.</strong>
        {{result.error.message}}
      </div>

      <div class="alert alert-suggest" ng-if="result.limit > 0 && !result.total && collection.can_add">
        No entities were found,
        <a ng-href="/collections/{{::collection.id}}/entities/bulk">
          create some now</a>?
      </div>

      <div>
        <table ng-if="result.results.length" class="table table-striped">
          <tr ng-show="collection.can_edit">
            <th></th>
            <th colspan="6">
              <div class="btn-group">
                <a ng-click="removeSelection($event)" class="btn btn-default btn-xs"
                  ng-disabled="!canRemove()">
                  <i class="fa fa-trash" aria-hidden="true"></i>
                  Remove entities
                </a>
                <a ng-click="mergeSelection($event)" class="btn btn-default btn-xs"
                  ng-disabled="!canMerge()">
                  <i class="fa fa-link" aria-hidden="true"></i>
                  Merge duplicates
                </a>
              </div>
            </th>
          </tr>
          <tr ng-show="false">
            <th colspan='7'
          </tr>
          <tr ng-repeat-start="entity in result.results track by entity.id">
            <td width="0%">
              <entity-icon schema="entity.schema"></entity-icon>
            </td>
            <td>
              <strong>
                <a href="/entities/{{::entity.id}}">{{::entity.name}}</a>
              </strong>
            </td>
            <td width="30%">
              <entity-source entity="entity" facets="result.facets">
              </entity-source>
            </td>
            <td width="10%" class="numeric">
              <entity-countries entity="entity"></entity-countries>
            </td>
          </tr>
          <tr ng-repeat-end ng-show="entity.data.summary">
            <td>
            </td>
            <td colspan="3">
              {{::entity.data.summary | limitTo:500}}
            </td>
          </tr>
        </table>
        <div class="bottom-pager">
          <div class="pull-right">
            <response-pager response="result" load="loadOffset(offset)"></response-pager>
          </div>
          <div class="total" ng-if="result.limit > 0 && result.total">
            Found {{result.total | number}} entities.
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="panel panel-default panel-facet panel-facet-scroll">
        <div class="panel-heading">
          <strong>Datasets</strong>
          <small>{{result.facets.dataset.values.length}}</small>
        </div>
        <ul class="list-group">
          <li class="list-group-item empty" ng-if="!result.facets.dataset.values.length">
            No entities linked to datasets.
          </li>
          <li class="list-group-item animate toggle"
            ng-repeat="val in result.facets.dataset.values"
            ng-class="{'active': query.hasFilter('dataset', val.id)}"
            ng-click="query.toggleFilter('dataset', val.id)">
            <span class="badge">{{val.count | number}}</span>
            <span class="lbl">
              {{::val.label}}
            </span>
          </li>
        </ul>
      </div>

      <div class="panel panel-default panel-facet panel-facet-scroll">
        <div class="panel-heading">
          <strong>Countries</strong>
          <small>{{result.facets.countries.values.length}}</small>
        </div>
        <ul class="list-group">
          <li class="list-group-item empty" ng-if="!result.facets.countries.values.length">
            No entities with country associations.
          </li>
          <li class="list-group-item animate toggle"
            ng-repeat="val in result.facets.countries.values"
            ng-class="{'active': query.hasFilter('countries', val.id)}"
            ng-click="query.toggleFilter('countries', val.id)">
            <span class="badge">{{val.count | number}}</span>
            <span class="lbl">
              {{::val.label}}
            </span>
          </li>
        </ul>
      </div>

      <div class="panel panel-default panel-facet">
        <div class="panel-heading">
          <strong>Types</strong>
          <small>{{result.facets.schemata.values.length}}</small>
        </div>
        <ul class="list-group">
          <li class="list-group-item empty" ng-if="!result.facets.schemata.values.length">
            No entities found.
          </li>
          <li class="list-group-item animate toggle"
            ng-repeat="val in result.facets.schemata.values"
            ng-class="{'active': query.hasFilter('schemata', val.id)}"
            ng-click="query.toggleFilter('schemata', val.id)">
            <span class="badge">{{val.count | number}}</span>
            <span class="lbl">
              <entity-icon schema="val.id"></entity-icon>
              {{::val.label | schemaPlural}}
            </span>
          </li>
        </ul>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <strong>Entity reconciliation</strong>
        </div>
        <div class="panel-body">
          <p>
            Use <a href="http://openrefine.org" target="_blank">OpenRefine</a>
            reconciliation to check what persons and companies are mentioned in
            your raw data.
            <a href="/help/reconcile">Learn more...</a>
          </p>
          <p class="help-block">
            Add a standard service in OpenRefine with this URL:
          </p>
          <input type="text" value="{{::getReconciliationUrl()}}"
            class="form-control" readonly="readonly"></div>
        </div>
      </div>
    </div>
  </div>
</div>
