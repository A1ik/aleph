<div class="row">
  <div class="col-md-8">
    <div class="alert alert-warning" ng-show="result.limit > 0 && !result.total">
      No results were found.
      <span ng-show="!session.logged_in">
        You may need to log in before you can see more results.
      </span>
    </div>

    <div infinite-scroll="loadMore()" infinite-scroll-disabled="!hasMore()"
      infinite-scroll-distance="3">
      <div class="result animate toggle" ng-repeat="doc in result.results">
        <search-result doc="doc" result="result"></search-result>
      </div>
    </div>
  </div>

  <div class="col-md-4">

    <div class="panel panel-default">
      <div class="panel-heading">
        <span class="pull-right">
          <a ng-click="selectWatchlists($event)">
            <i class="fa fa-cog"></i>
          </a>
        </span>
        <strong>Persons and Companies</strong>
        <small ng-show="query.state.watchlist.length">
          (from {{query.state.watchlist.length}} watchlists)
        </small>
      </div>
      <ul class="list-group facet-list">
        <li class="list-group-item facet empty" ng-if="!result.entities.length">
          <span ng-hide="query.state.watchlist.length">
            <a ng-click="selectWatchlists($event)"><i class="fa fa-cog"></i> Select watchlists</a> to see tagged entities.
          </span>
          <span ng-show="query.state.watchlist.length">
            The selected watchlists don't match any documents.
          </span>
        </li>
        <li class="list-group-item facet animate toggle"
          ng-repeat="entity in result.entities"
          ng-class="{'active': query.hasFilter('entity', entity.id)}"
          ng-click="query.toggleFilter('entity', entity.id)">
          <span class="badge">{{entity.count}}</span>
          <entity-icon category="entity.category"></entity-icon>
          <span class="lbl" uib-tooltip="{{metadata.watchlists[entity.watchlist_id].label}}"
            tooltip-append-to-body="true" tooltip-placement="right">
            {{entity.name}}
          </span>
        </li>
      </ul>
    </div>

    <div class="btn-group btn-group-justified" role="group">
      <div class="btn-group" uib-dropdown dropdown-append-to-body>
        <button type="button" class="btn btn-primary dropdown-toggle"
          uib-dropdown-toggle>
          <i class="fa fa-filter"></i>
          Filter by type, language, country
          <span class="caret"></span>
        </button>
        <ul class="uib-dropdown-menu" role="menu">
          <li ng-repeat="(field, label) in metadata.fields"
            ng-show="showFieldFacet(field)">
            <a ng-click="query.toggleFilter('facet', field)" ng-bind="label"></a>
          </li>
        </ul>
      </div>
    </div>
    <br/>

    <div class="panel panel-default" ng-repeat="field in query.load().facet"
      ng-if="result.facets && result.facets[field]">
      <div class="panel-heading">
        <span class="pull-right">
          <a ng-click="query.toggleFilter('facet', field)">
            <i class="fa fa-close"></i>
          </a>
        </span>
        <strong>{{fields[field]}}</strong>
      </div>
      <ul class="list-group facet-list">
        <li class="list-group-item facet empty" ng-if="!result.facets[field].values.length">
          no matching documents
        </li>
        <li class="list-group-item facet animate toggle"
          ng-repeat="val in result.facets[field].values"
          ng-class="{'active': query.hasFilter('filter:' + field, val.id)}"
          ng-click="query.toggleFilter('filter:' + field, val.id)">
          <span class="badge">{{val.count}}</span>
          <span class="lbl" uib-tooltip="{{val.label}}" tooltip-append-to-body="true" tooltip-placement="left">
            {{val.label | characters: 35 }}
          </span>
        </li>
      </ul>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <strong>Document sources</strong>
      </div>
      <ul class="list-group facet-list">
        <li class="list-group-item facet animate toggle"
          ng-repeat="source in result.sources.values"
          ng-class="{'active': query.hasFilter('filter:source_id', source.id)}"
          ng-click="query.toggleFilter('filter:source_id', source.id)">
          <span class="badge">{{source.count}}</span>
          <span class="lbl">
            {{source.label}}
            <a ng-click="editSource(source, $event)" ng-show="canEditSource(source)">
              <i class="fa fa-cog"></i>
            </a>
          </span>
        </li>
      </ul>
    </div>


    <div class="panel panel-default">
      <div class="panel-heading">
        <strong>Download result list</strong>
      </div>
      <div class="panel-body">
        <p>
          You can download links and other meta data for all documents
          matching your search criteria.
        </p>
        <a class="btn btn-primary"
          ng-href="/api/1/query/export?{{query.queryString()}}"
          download target="_self">
          <i class="fa fa-cloud-download"></i>
          Download {{result.total}} search results (Excel 2007)
        </a>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <strong>Download watchlist network</strong>
      </div>
      <div class="panel-body">
        <p>
          Get data to further analyze the connections between
          watchlist entities. Links connect entities occuring
          in the same document.
        </p>
        <p class="help-block">
          This data format is suited for import into <a href="http://gephi.org">Gephi</a>, an open source network analysis tool. 
        </p>
        <a ng-href="/api/1/graph?format=gexf&limit=2000&{{query.queryString()}}" class="btn btn-primary" target="_self"
        download="actors.gexf">
          <i class="fa fa-cloud-download"></i>
          Download Graph Exchange XML (GEXF)
        </a>
      </div>
    </div>

  </div>
</div>

