<div class="row">
  <div class="col-md-9">
    <ul class="nav nav-tabs">
      <li role="presentation" ng-class="{'active': query.mode() == 'table'}">
        <a ng-href="/#/search?{{ query.queryString() }}">
          Documents <span class="badge">{{result.total || ''}}</span>
        </a>
      </li>
      <li role="presentation" ng-class="{'active': query.mode() == 'graph'}">
        <a ng-href="/#/search/graph?{{ query.queryString() }}">Actor network</a>
      </li>
      <li role="presentation" ng-class="{'active': query.mode() == 'export'}">
        <a ng-href="/#/search/export?{{ query.queryString() }}">Export</a>
      </li>
    </ul>

    <div class="alert alert-warning" ng-show="result.limit > 0 && !result.total">
      No results were found.
      <span ng-show="!session.logged_in">
        You may need to log in before you can see more results.
      </span>
    </div>

    <div ng-transclude></div>
  </div>

  <div class="col-md-3">

    <div class="btn-group btn-group-justified" role="group">
      <div class="btn-group" role="group" uib-dropdown>
        <button type="button" class="btn btn-default dropdown-toggle"
          uib-dropdown-toggle>
          <i class="fa fa-list-alt"></i>
          Add filters
          <span class="caret"></span>
        </button>
        <ul class="uib-dropdown-menu" role="menu">
          <li ng-repeat="(id, watchlist) in metadata.watchlists"
            ng-show="showListFacet(id)">
            <a ng-click="query.toggleFilter('watchlist', id)"
              ng-bind="watchlist.label"></a>
          </li>
          <li class="divider"></li>
          <li ng-repeat="(field, label) in metadata.fields"
            ng-show="showFieldFacet(field)">
            <a ng-click="query.toggleFilter('facet', field)" ng-bind="label"></a>
          </li>
        </ul>
      </div>
    </div>
    <br/>

    <div class="panel panel-default" ng-repeat="id in query.load().watchlist">
      <div class="panel-heading">
        <span class="pull-right">
          <a ng-href="/#/lists/{{id}}/entities" ng-show="session.logged_in">
            <i class="fa fa-cog"></i>
          </a>
          <a ng-click="query.toggleFilter('watchlist', id)">
            <i class="fa fa-close"></i>
          </a>
        </span>
        List: {{watchlists[id].label}}
        <span class="label label-warning" ng-hide="result.watchlists && result.watchlists[id] && result.watchlists[id].entities.length">no options</span>
      </div>
      <ul class="list-group facet-list">
        <li class="list-group-item facet animate toggle"
          ng-repeat="entity in result.watchlists[id].entities"
          ng-class="{'active': query.hasFilter('entity', entity.id)}"
          ng-click="query.toggleEntityFilter(entity.id, id)">
          <span class="badge">{{entity.count}}</span>
          <entity-icon category="entity.category"></entity-icon>
          <span class="lbl" uib-tooltip="{{entity.name.length > 35 ? entity.name : ''}}"
            tooltip-append-to-body="true" tooltip-placement="left">
            {{entity.name | characters: 35 }}
          </span>
        </li>
      </ul>
    </div>

    <div class="panel panel-default" ng-repeat="field in query.load().facet">
      <div class="panel-heading">
        <span class="pull-right">
          <a ng-click="query.toggleFilter('facet', field)">
            <i class="fa fa-close"></i>
          </a>
        </span>
        {{fields[field]}}
        <span class="label label-warning" ng-hide="result.facets && result.facets[field]">no options</span>
      </div>
      <ul class="list-group facet-list">
        <li class="list-group-item facet animate toggle"
          ng-repeat="val in result.facets[field].values"
          ng-class="{'active': query.hasFilter('filter:' + field, val.id)}"
          ng-click="query.toggleFilter('filter:' + field, val.id)">
          <span class="badge">{{val.count}}</span>
          <span class="lbl" uib-tooltip="{{val.label}}" tooltip-append-to-body="true" tooltip-placement="left">
            {{val.label | characters: 35 }}
          </span>
        </li>
      </ul>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <span class="pull-right">
          <a href="/#/sources" ng-show="session.logged_in">
            <i class="fa fa-cog"></i>
          </a>
        </span>
        Document sources
      </div>
      <ul class="list-group facet-list">
        <li class="list-group-item facet animate toggle"
          ng-repeat="facet in result.sources.values"
          ng-class="{'active': query.hasFilter('filter:source_id', facet.id)}"
          ng-click="query.toggleFilter('filter:source_id', facet.id)">
          <span class="badge">{{facet.count}}</span>
          <span class="lbl">
            {{facet.label | characters: 20 }}
          </span>
        </li>
      </ul>
    </div>
  </div>
</div>

